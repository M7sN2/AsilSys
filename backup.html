<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-hashes'; style-src 'self' 'unsafe-inline'; font-src 'self' data:; img-src 'self' data:; connect-src 'self';">
    <title>ุงููุณุฎ ุงูุงุญุชูุงุทู - ูุธุงู ุฃุณูู</title>
    <link rel="stylesheet" href="styles/customers.css">
    <link rel="stylesheet" href="styles/backup.css">
    <link rel="stylesheet" href="styles/topbar.css">
    <link rel="stylesheet" href="styles/main.css">
    <style>
        /* Fallback styles if CSS files fail to load */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            direction: rtl;
        }
    </style>
</head>
<body>
    <!-- Sticky Top Bar -->
    <div class="top-bar">
        <button class="top-bar-sidebar-toggle" id="topBarSidebarToggle" title="ุฅุฎูุงุก/ุฅุธูุงุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <div class="top-bar-time" id="topBarTime">
            <span style="font-size: 12px;">๐</span> --:--:--
        </div>

        <div class="top-bar-notifications" id="topBarNotificationsBtn" title="ุงูุฅุดุนุงุฑุงุช">
            <img src="assets/bell.ico" alt="ุงูุฅุดุนุงุฑุงุช" onerror="this.style.display='none'" />
            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>

            <!-- Notifications Popup - Directly under button -->
            <div class="notifications-popup" id="notificationsPopup">
                <div class="popup-header">
                    <h3>ุงูุฅุดุนุงุฑุงุช</h3>
                    <button class="close-popup-btn" id="closeNotificationsBtn">&times;</button>
                </div>
                <div class="popup-content">
                    <div class="notifications-section">
                        <h4>๐ฆ ุงููุฎุฒูู ุงูููุฎูุถ / ููุฏ ุงููุฎุฒูู</h4>
                        <div class="notifications-list" id="lowStockNotifications">
                            <div class="notification-item loading">ุฌุงุฑู ุงูุชุญููู...</div>
                        </div>
                    </div>
                    <div class="notifications-section">
                        <h4>๐ฅ ุนููุงุก ุฑุตูุฏูู ูุชุฎุทู 10,000 ุฌ.ู</h4>
                        <div class="notifications-list" id="highBalanceNotifications">
                            <div class="notification-item loading">ุฌุงุฑู ุงูุชุญููู...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <a href="calculator.html" class="top-bar-calculator" title="ุขูุฉ ุญุงุณุจุฉ">
            <img src="assets/calculator-app-icon.ico" alt="ุขูุฉ ุญุงุณุจุฉ" onerror="this.style.display='none'" />
        </a>

        <div class="top-bar-user-greeting" id="topBarUserGreeting" style="display: none;">
            <img src="assets/user_10542498.ico" alt="User" class="user-icon" onerror="this.style.display='none'" />
            <span class="greeting-text">ูุฑุญุจูุงุ <strong id="topBarUsername">ูุณุชุฎุฏู</strong></span>
        </div>

        <button class="top-bar-logout" id="topBarLogoutBtn" title="ุชุณุฌูู ุงูุฎุฑูุฌ">
            <img src="assets/switch.ico" alt="ุชุณุฌูู ุงูุฎุฑูุฌ" onerror="this.style.display='none'" />
        </button>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">ุฃุณูู</div>
            <p class="system-name">ูุธุงู ุฅุฏุงุฑุฉ ุงูุดุฑูุฉ</p>
        </div>
        <ul class="sidebar-menu">
            <li><a href="index.html"><span class="icon">๐</span> ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ</a></li>
            <li><a href="products.html"><span class="icon">๐ฆ</span> ุงูููุชุฌุงุช</a></li>
            <li><a href="customers.html"><span class="icon">๐ฅ</span> ุงูุนููุงุก <span class="sidebar-badge" id="inactiveCustomersBadge" style="display: none;">0</span></a></li>
            <li><a href="suppliers.html"><span class="icon">๐ข</span> ุงูููุฑุฏูู</a></li>
            <li><a href="sales.html"><span class="icon">๐ฐ</span> ุงููุจูุนุงุช</a></li>
            <li><a href="delivery-notes.html"><span class="icon">๐</span> ุฃุฐูู ุงูุตุฑู</a></li>
            <li><a href="receipts.html"><span class="icon">๐ต</span> ุณูุฏุงุช ุงููุจุถ</a></li>
            <li><a href="payments.html"><span class="icon">๐ธ</span> ุณูุฏุงุช ุงูุตุฑู</a></li>
            <li><a href="purchases.html"><span class="icon">๐</span> ุงููุดุชุฑูุงุช</a></li>
            <li><a href="inventory.html"><span class="icon">๐</span> ุฅุฏุงุฑุฉ ุงูุฌุฑุฏ ูุงููุฑุชุฌุนุงุช</a></li>
            <li><a href="assets.html"><span class="icon">๐๏ธ</span> ุฃุตูู ุงูุดุฑูุฉ</a></li>
            <li><a href="reports.html"><span class="icon">๐</span> ุญุณุงุจ ุงูุฃุฑุจุงุญ</a></li>
            <li><a href="expenses.html"><span class="icon">๐ผ</span> ุงููุตุงุฑูู ุงูุชุดุบูููุฉ</a></li>
            <li><a href="backup.html" class="active"><span class="icon">๐พ</span> ุงููุณุฎ ุงูุงุญุชูุงุทู</a></li>
            <li><a href="action-logs.html"><span class="icon">๐</span> ุณุฌู ุงูุญุฑูุงุช</a></li>
            <li><a href="users.html"><span class="icon">๐ค</span> ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช</a></li>
            <li><a href="settings.html"><span class="icon">โ๏ธ</span> ุงูุฅุนุฏุงุฏุงุช</a></li>
            <li><a href="about.html"><span class="icon">๐ง</span> ุนู ุงูุดุฑูุฉ</a></li>
            <li><a href="marketing.html"><span class="icon">๐ข</span> ุงูุนุฑุถ ุงูุชุณูููู</a></li>
            <li class="logout-item">
                <button class="logout-btn" title="ุชุณุฌูู ุงูุฎุฑูุฌ">
                    <img src="assets/logout-16.ico" alt="ุชุณุฌูู ุงูุฎุฑูุฌ" class="icon" onerror="this.style.display='none'">
                    <span>ุชุณุฌูู ุงูุฎุฑูุฌ</span>
                </button>
            </li>
        </ul>
        <div class="sidebar-footer">
            <p class="copyright-text">ยฉ 2025 ูุธุงู ุฃุณูู โ ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ ุงููููุฏุณ ูุญูุฏ ูุญุณู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-header">
            <h1>ุงููุณุฎ ุงูุงุญุชูุงุทู</h1>
        </div>

        <!-- Backup Actions -->
        <div class="backup-actions">
            <div class="action-card">
                <div class="action-icon">๐ฅ</div>
                <h3>ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ</h3>
                <p>ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</p>
                <button class="btn btn-primary" id="createBackupBtn">
                    <span>+</span> ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
                </button>
            </div>

            <div class="action-card">
                <div class="action-icon">๐ค</div>
                <h3>ุงุณุชุนุงุฏุฉ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</h3>
                <p>ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุญููุธุฉ</p>
                <button class="btn btn-secondary" id="restoreBackupBtn">
                    <span>โป</span> ุงุณุชุนุงุฏุฉ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
                </button>
            </div>
        </div>

        <!-- Backup History -->
        <div class="backup-history-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">ุชุงุฑูุฎ ุงููุณุฎ ุงูุงุญุชูุงุทู</h2>
                <button class="btn btn-secondary" id="refreshBackupListBtn" title="ุชุญุฏูุซ ูุงุฆูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ">
                    <span>๐</span> ุชุญุฏูุซ
                </button>
            </div>
            <div class="table-container">
                <table class="backup-history-table">
                    <thead>
                        <tr>
                            <th>ุงูุชุงุฑูุฎ</th>
                            <th>ุงููุณุงุฑ</th>
                            <th>ุงูููุน</th>
                            <th>ุงูุญุฌู</th>
                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody id="backupHistoryBody">
                        <tr>
                            <td colspan="5" class="text-center">ุฌุงุฑู ุงูุชุญููู...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="empty-state hidden" id="emptyState">
                <p>ูุง ุชูุฌุฏ ูุณุฎ ุงุญุชูุงุทูุฉ</p>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" id="paginationContainer">
            <div class="pagination-info">
                <span id="paginationInfo">ุนุฑุถ 0 - 0 ูู 0</span>
            </div>
            <div class="pagination-controls">
                <button type="button" id="prevPageBtn" class="btn btn-secondary" disabled>โ ุงูุณุงุจู</button>
                <span class="page-numbers" id="pageNumbers"></span>
                <button type="button" id="nextPageBtn" class="btn btn-secondary" disabled>ุงูุชุงูู โ</button>
            </div>
        </div>

        <!-- Auto Backup Settings -->
        <div class="auto-backup-section">
            <h2>ุฅุนุฏุงุฏุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู</h2>
            <div class="settings-card">
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="autoBackupEnabled">
                        ุชูุนูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู
                    </label>
                </div>
                <div class="form-group" id="autoBackupPathGroup" style="display: none;">
                    <label for="backupPath">ูุณุงุฑ ุงูุญูุธ:</label>
                    <div class="input-group">
                        <input type="text" id="backupPath" readonly placeholder="ุงุฎุชุฑ ูุฌูุฏ ุญูุธ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ">
                        <button class="btn btn-secondary" id="selectBackupPathBtn">ุงุฎุชุฑ ุงููุฌูุฏ</button>
                    </div>
                    <small style="display: block; margin-top: 8px; color: #666;">
                        ุณูุชู ุญูุธ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุชููุงุฆูุฉ ูู ูุฐุง ุงููุฌูุฏ
                    </small>
                </div>
                <div class="form-group" id="autoBackupIntervalGroup" style="display: none;">
                    <label for="backupInterval">ูุชุฑุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู:</label>
                    <select id="backupInterval" class="form-control">
                        <option value="daily">ูููู (ูู ููู)</option>
                        <option value="weekly">ุฃุณุจูุนู (ูู ุฃุณุจูุน)</option>
                        <option value="monthly">ุดูุฑู (ูู ุดูุฑ)</option>
                    </select>
                    <small style="display: block; margin-top: 8px; color: #666;">
                        ุณูุชู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุชููุงุฆูุงู ุญุณุจ ุงููุชุฑุฉ ุงููุญุฏุฏุฉ ุนูุฏ ุฅุบูุงู ุงูุจุฑูุงูุฌ
                    </small>
                </div>
                <button class="btn btn-primary" id="saveAutoBackupBtn">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
            </div>
        </div>
    </main>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script>
        // Global error handler for missing resources
        window.addEventListener('error', function(e) {
            // Ignore errors from missing images/assets - they're non-critical
            if (e.target && (e.target.tagName === 'IMG' || e.target.tagName === 'LINK')) {
                console.warn('Resource failed to load:', e.target.src || e.target.href);
                e.preventDefault();
                return false;
            }
        }, true);
        
        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            // Don't show error to user for non-critical errors
            e.preventDefault();
        });
    </script>
    <script src="scripts/header.js"></script>
    <script src="scripts/toast.js"></script>
    <script src="scripts/permissions.js"></script>
    <script src="scripts/sidebar.js"></script>
    <script src="scripts/logout.js"></script>
    <script src="scripts/backup.js"></script>
</body>
</html>

